version: "3.8"

services:
    mysql:
        # Config del contenidor de la bd
        image: mysql:8.0
        container_name: mysql_container
        
        # Config de la xarxa
        networks:
            app_net:
                ipv4_address: 172.20.0.10

        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: magatzem
            MYSQL_USER: juanito
            MYSQL_PASSWORD: 1234
        
        volumes:
            - mysql_data:/var/lib/mysql
            - ./sql:/docker-entrypoint-initdb.d
        restart: unless-stopped

    php:
        # Config del contenidor PHP - Apache
        image: php:7.4-apache
        container_name: php_apache
        ports:
            - "8888:80"
        
        # Volums del contenidor
        volumes:
            - ./html:/var/www/html
            - ./docker/php-init.sh:/usr/local/bin/php-init.sh
        
        # Dependencies
        depends_on:
            - mysql

        # Nomes reiniciar quan el contenidor es pari
        restart: unless-stopped

        # Comanda
        command: ["sh", "/usr/local/bin/php-init.sh"]

        networks:
            app_net:
                ipv4_address: 172.20.0.15

networks:
    app_net:
        # Configuraci√≥ de les Ip fixes
        driver: bridge
        ipam:
            config:
                # Rang de la xarxa   
                - subnet: 172.20.0.0/16

volumes:
    mysql_data: